name: CultureLens
options:
  bundleIdPrefix: com.culturelens
  deploymentTarget:
    iOS: "16.0"
  xcodeVersion: "15.0"
  generateEmptyDirectories: true
  groupSortPosition: top

settings:
  base:
    MARKETING_VERSION: "1.1.1"
    CURRENT_PROJECT_VERSION: "3"
    DEVELOPMENT_TEAM: ""
    CODE_SIGN_STYLE: Automatic
    SWIFT_VERSION: "5.9"
    ENABLE_USER_SCRIPT_SANDBOXING: false

packages:
  Firebase:
    url: https://github.com/firebase/firebase-ios-sdk.git
    from: "10.0.0"
  GoogleSignIn:
    url: https://github.com/google/GoogleSignIn-iOS.git
    from: "7.0.0"

targets:
  CultureLens:
    type: application
    platform: iOS
    sources:
      - path: CultureLens
        excludes:
          - "**/*.plist.example"
    resources:
      - path: CultureLens/Resources
        excludes:
          - "**/*.example"
      - path: CultureLens/Info.plist
    settings:
      base:
        INFOPLIST_FILE: CultureLens/Info.plist
        PRODUCT_BUNDLE_IDENTIFIER: com.culturelens.app
        ASSETCATALOG_COMPILER_APPICON_NAME: AppIcon
        ASSETCATALOG_COMPILER_GLOBAL_ACCENT_COLOR_NAME: AccentColor
        LD_RUNPATH_SEARCH_PATHS: $(inherited) @executable_path/Frameworks
        SWIFT_EMIT_LOC_STRINGS: true
        TARGETED_DEVICE_FAMILY: "1,2"  # iPhone and iPad
        SUPPORTS_MAC_DESIGNED_FOR_IPHONE_IPAD: true
    dependencies:
      - package: Firebase
        product: FirebaseAuth
      - package: Firebase
        product: FirebaseFirestore
      - package: Firebase
        product: FirebaseStorage
      - package: Firebase
        product: FirebaseCrashlytics
      - package: GoogleSignIn
        product: GoogleSignIn
      - package: GoogleSignIn
        product: GoogleSignInSwift
    info:
      path: CultureLens/Info.plist
      properties:
        CFBundleDisplayName: CultureLens
        CFBundleShortVersionString: "$(MARKETING_VERSION)"
        CFBundleVersion: "$(CURRENT_PROJECT_VERSION)"
        UILaunchScreen:
          UIColorName: LaunchScreenBackground
        NSMicrophoneUsageDescription: CultureLens needs microphone access to record and analyze conversations with the AI voice agent.
        UIApplicationSceneManifest:
          UIApplicationSupportsMultipleScenes: false
        UISupportedInterfaceOrientations:
          - UIInterfaceOrientationPortrait
          - UIInterfaceOrientationLandscapeLeft
          - UIInterfaceOrientationLandscapeRight
        UISupportedInterfaceOrientations~ipad:
          - UIInterfaceOrientationPortrait
          - UIInterfaceOrientationPortraitUpsideDown
          - UIInterfaceOrientationLandscapeLeft
          - UIInterfaceOrientationLandscapeRight
        UIRequiresFullScreen: false
        ITSAppUsesNonExemptEncryption: false
        CFBundleURLTypes:
          - CFBundleURLSchemes:
              - com.googleusercontent.apps.407570374043-lmu50155qnjh0k3k94hq1vericp6ubtf
            CFBundleURLName: Google Sign-In

  CultureLensTests:
    type: bundle.unit-test
    platform: iOS
    sources:
      - path: CultureLensTests
    dependencies:
      - target: CultureLens
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.culturelens.app.tests
        TEST_HOST: "$(BUILT_PRODUCTS_DIR)/CultureLens.app/$(BUNDLE_EXECUTABLE_FOLDER_PATH)/CultureLens"
        BUNDLE_LOADER: "$(TEST_HOST)"

  CultureLensUITests:
    type: bundle.ui-testing
    platform: iOS
    sources:
      - path: CultureLensUITests
    dependencies:
      - target: CultureLens
    settings:
      base:
        PRODUCT_BUNDLE_IDENTIFIER: com.culturelens.app.uitests
        TEST_TARGET_NAME: CultureLens

schemes:
  CultureLens:
    build:
      targets:
        CultureLens: all
        CultureLensTests: [test]
        CultureLensUITests: [test]
    run:
      config: Debug
    test:
      config: Debug
      gatherCoverageData: true
      coverageTargets:
        - CultureLens
      targets:
        - CultureLensTests
        - CultureLensUITests
    profile:
      config: Release
    analyze:
      config: Debug
    archive:
      config: Release
